# IDD Agent 概述

> 驱动 Intent 驱动开发的自主 Agent

## 什么是 IDD Agent？

IDD Agent 是专门的 AI 代理，根据 Intent 文档自主工作来验证、实现和验证代码。与交互式技能（命令）不同，Agent 在后台工作，用户干预最少。

## Agent 分类

### 验证 Agent

这些 Agent 确保 Intent 质量和一致性：

| Agent | 用途 | 触发时机 |
|-------|------|---------|
| intent-validate | 格式合规 | Intent 修改后 |
| intent-sync | 实现一致性 | 代码变更后 |
| intent-audit | 项目健康 | 定期 / 按需 |

### TDD 执行 Agent

这些 Agent 组成从 Intent 构建代码的 TDD 团队：

| Agent | 角色 | 在工作流中 |
|-------|------|-----------|
| idd-task-execution-master | 阶段规划 | 第一步：将 Intent 分解为阶段 |
| idd-test-master | 测试设计 | 第二步：在代码之前写测试 |
| idd-code-guru | 实现 | 第三步：实现以通过测试 |
| idd-e2e-test-queen | E2E 验证 | 第四步：端到端验证 |

## TDD Agent 团队工作流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                        TDD Agent 团队                                │
│                                                                      │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                 idd-task-execution-master                     │   │
│  │                                                               │   │
│  │  输入: 已批准的 Intent 文档                                    │   │
│  │  输出: 带任务的阶段性执行计划                                   │   │
│  │                                                               │   │
│  │  • 验证 Intent 完整性                                         │   │
│  │  • 将工作分解为逻辑阶段                                        │   │
│  │  • 定义完成标准                                               │   │
│  │  • 协调其他 Agent                                             │   │
│  └───────────────────────────┬──────────────────────────────────┘   │
│                              │                                       │
│                              ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                     idd-test-master                           │   │
│  │                                                               │   │
│  │  输入: execution-master 的任务定义                             │   │
│  │  输出: 全面的测试规格                                          │   │
│  │                                                               │   │
│  │  • 正常路径测试                                               │   │
│  │  • 异常路径测试（详细、全面）                                   │   │
│  │  • 边界条件测试                                               │   │
│  │  • 安全测试                                                   │   │
│  │  • 数据泄露测试                                               │   │
│  │  • 数据损坏测试                                               │   │
│  └───────────────────────────┬──────────────────────────────────┘   │
│                              │                                       │
│                              ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                      idd-code-guru                            │   │
│  │                                                               │   │
│  │  输入: test-master 的测试规格                                  │   │
│  │  输出: 通过所有测试的优雅实现                                   │   │
│  │                                                               │   │
│  │  • 干净、可维护的代码                                          │   │
│  │  • 遵循项目模式                                               │   │
│  │  • 无代码重复                                                 │   │
│  │  • 正确的命名和结构                                           │   │
│  └───────────────────────────┬──────────────────────────────────┘   │
│                              │                                       │
│                              ▼                                       │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │                   idd-e2e-test-queen                          │   │
│  │                                                               │   │
│  │  输入: 已完成的阶段实现                                        │   │
│  │  输出: E2E 验证结果                                           │   │
│  │                                                               │   │
│  │  • 端到端测试设计                                             │   │
│  │  • 优先 CLI 验证                                              │   │
│  │  • 阶段门验证                                                 │   │
│  │  • 集成测试                                                   │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

## 核心原则

### 1. 测试优先，始终如此

TDD Agent 强制严格的测试优先开发：

```
错误: Code → Tests → Fix
正确: Tests → Code → Verify
```

没有 Agent 会在测试存在之前写实现代码。

### 2. 不可变的测试契约

`idd-test-master` 设计的测试是契约：

- 不能修改测试来让代码通过
- 必须修复代码，而不是测试
- 例外需要明确批准

### 3. 阶段门

每个阶段以 E2E 验证结束：

```
阶段 1: 核心 ──────▶ E2E 门 ──────▶ 阶段 2: 集成
                        │
                        ▼
                   所有测试通过？
                   ├── 是: 继续
                   └── 否: 先修复
```

### 4. Agent 自治

Agent 在其范围内工作：

- Task-execution-master: 只做规划
- Test-master: 只做测试设计
- Code-guru: 只做实现
- E2E-test-queen: 只做验证

没有 Agent 跨越到另一个的领域。

## 触发 Agent

### 自动（通过 /intent-build-now）

```bash
/intent-build-now
```

验证 Intent 并协调完整的 Agent 团队。

### 手动（通过 Task 工具）

```bash
# 启动特定 Agent
Task: idd-test-master
Prompt: "根据这个 Intent 为认证模块设计测试: ..."
```

### 通过 /intent-check

```bash
/intent-check
```

自动触发验证 Agent。

## 最佳实践

### 1. 信任过程

让 Agent 自主工作。只在被询问时介入。

### 2. 提供完整的 Intent

Agent 在完整、明确的 Intent 文档下工作最好。

### 3. 审查阶段门

在进入下一阶段之前检查 E2E 结果。

### 4. 不要跳过 Agent

链条一起工作。跳过 test-master 会破坏整个过程。

## 相关文档

- [IDD 工作流程](../workflow.md) - 上下文中的 Agent
- [/intent-build-now](../commands/intent-build-now.md) - 启动 Agent
