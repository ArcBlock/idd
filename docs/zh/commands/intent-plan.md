# /intent-plan

> 生成严格 TDD 的阶段性执行计划

## 用法

```bash
/intent-plan
/intent-plan path/to/INTENT.md
```

## 目的

将已批准的 Intent 转换为结构化的、可执行的开发计划，遵循严格的 TDD 纪律。与 `/intent-build-now` 不同，这会生成用于手动执行的计划，而不是自动 Agent 编排。

## 何时使用

- 想在执行前审查计划
- 偏好手动控制实现
- 需要与团队分享计划
- 逐步学习 IDD 工作流程

## 计划结构

```
阶段 1: [阶段名称]
├── 步骤 1.1: [功能/组件]
│   ├── 单元 1: 编写测试
│   │   ├── 正常路径用例
│   │   ├── 异常路径用例
│   │   ├── 边界用例
│   │   ├── 安全测试
│   │   ├── 数据泄露测试
│   │   └── 数据损坏测试
│   └── 单元 2: 实现
│       └── 让所有测试通过
├── 步骤 1.2: [下一功能]
│   └── ...
└── 阶段门禁: E2E 验证
    └── 基于 CLI/脚本的验证

阶段 2: [阶段名称]
└── ...
```

## 测试类别

每个步骤都需要全面的测试覆盖：

| 类别 | 目的 | 示例 |
|------|------|------|
| **正常路径** | 正常使用 | 有效输入，正确序列 |
| **异常路径** | 错误条件 | 错误类型，缺失字段 |
| **边界用例** | 边界条件 | 空输入，最大值 |
| **安全** | 漏洞预防 | 注入，认证绕过 |
| **数据泄露** | 信息暴露 | 日志中的敏感数据 |
| **数据损坏** | 数据完整性 | 部分写入，损坏 |

## 输出：PLAN.md

```markdown
# [项目/功能] 实现计划

生成自：`intent/[name]/INTENT.md`
日期：2024-01-21

## 概述

- 总阶段数：3
- 复杂度：中等
- 关键依赖：auth-service, database

## 阶段 1：核心功能

**目标**：基本支付处理工作

### 步骤 1.1：支付验证

**单元 1：测试**（先做）

| 类别 | 测试用例 |
|------|----------|
| 正常路径 | 有效金额成功处理 |
| 异常路径 | 负数金额被拒绝 |
| 异常路径 | 零金额被拒绝 |
| 边界用例 | 最大金额（系统限制） |
| 安全 | 元数据中的 SQL 注入 |
| 数据泄露 | 卡号不在日志中 |

**单元 2：实现**

- [ ] 实现 validatePayment()
- [ ] 确保所有测试通过

### 步骤 1.2：支付处理

[...]

### 阶段 1 门禁：E2E 验证

\```bash
# 验证支付流程
curl -X POST http://localhost:3000/api/payments \
  -H "Content-Type: application/json" \
  -d '{"amount": 1000, "currency": "USD"}' | jq .
\```

**成功标准：**
- [ ] 支付创建成功
- [ ] 返回正确状态
- [ ] 数据库记录存在

---

## 阶段 2：错误处理

[...]
```

## 示例会话

```
> /intent-plan intent/payment/INTENT.md

读取 Intent...
分析范围和复杂度...

## 执行计划已生成

### 阶段概述

| 阶段 | 目标 | 任务数 |
|------|------|--------|
| 1 | 核心处理 | 3 |
| 2 | 错误处理 | 2 |
| 3 | 集成 | 2 |

### 阶段 1：核心处理

步骤 1.1：支付验证
- 识别了 12 个测试用例
- 实现范围：1 个文件

步骤 1.2：支付执行
- 识别了 8 个测试用例
- 实现范围：2 个文件

步骤 1.3：收据生成
- 识别了 6 个测试用例
- 实现范围：1 个文件

阶段门禁：通过 CLI 验证支付可以处理

[完整计划继续...]

计划已保存到：intent/payment/PLAN.md

下一步：
1. 审查计划
2. 开始阶段 1，步骤 1.1
3. 先写测试，再实现
4. 在阶段 2 之前运行阶段门禁验证
```

## vs /intent-build-now

| 方面 | /intent-plan | /intent-build-now |
|------|--------------|-------------------|
| 输出 | PLAN.md 文件 | 自动执行 |
| 控制 | 手动 | Agent 驱动 |
| 用例 | 先审查 | 信任过程 |
| 学习 | 更适合初学者 | 更适合有经验者 |

## 最佳实践

1. **合理划分阶段** - 每个阶段 1-3 天可完成
2. **清晰的依赖** - 注明步骤的先决条件
3. **具体的测试用例** - "测试 404 响应" 而不是 "测试错误"
4. **可自动化的门禁** - 优先使用 CLI 验证

## 相关命令

- [/intent-build-now](intent-build-now.md) - 自动执行
- [/intent-review](intent-review.md) - 规划前批准
- [/intent-sync](intent-sync.md) - 执行后同步

## 另请参阅

- [IDD 工作流程](../workflow.md) - 规划在上下文中的位置
- [Agent 概述](../agents/overview.md) - TDD Agent 团队
